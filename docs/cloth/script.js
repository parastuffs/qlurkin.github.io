import load_file from '../gameoflife/load_file.js'
import interpolate from '../gameoflife/interpolate.js'

if (!navigator.gpu) {
  document.querySelector('.alert').innerHTML =
    'WebGPU not supported on this browser.'
  throw new Error('WebGPU not supported on this browser.')
}

///////////////////////////////////////////////////////////////////////////////////////////
// Params
///////////////////////////////////////////////////////////////////////////////////////////
const CLOTH_SIZE = 384
const WORKGROUP_SIZE = 8
const SUB_STEP = 100

///////////////////////////////////////////////////////////////////////////////////////////
// Device Configuration
///////////////////////////////////////////////////////////////////////////////////////////
const canvas = document.querySelector('canvas')

const adapter = await navigator.gpu.requestAdapter()
if (!adapter) {
  throw new Error('No appropriate GPUAdapter found.')
}

const device = await adapter.requestDevice()
const context = canvas.getContext('webgpu')
const canvasFormat = navigator.gpu.getPreferredCanvasFormat()
context.configure({
  device: device,
  format: canvasFormat,
})

///////////////////////////////////////////////////////////////////////////////////////////
// Buffers
///////////////////////////////////////////////////////////////////////////////////////////
