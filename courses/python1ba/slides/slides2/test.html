<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Document</title>
   <style>
      body {
         font-family: monospace;
      }
   </style>

</head>
<body>
   <div id="drawing"></div>
   <script type="module">
      import {SVG, Polyline, Point} from 'https://cdnjs.cloudflare.com/ajax/libs/svg.js/3.1.1/svg.esm.min.js'
      const draw = SVG().size(800, 800).addTo('#drawing')
      /*const rect = draw.rect().size(200, 100).fill('#f06').radius(5)
      const text = draw.text("Hello\nWorld").center(100, 50)
      console.log(text.bbox().cx)

      const rect2 = draw.rect().size(200, 100).fill('#f06').radius(5).move(300, 300)
      const text2 = draw.text("Hello\nWorld").center(100+300, 50+300)

      const point = new Point(1, 1)
      console.log()*/

      function sizeTo(elem, content) {
         bbox = content.bbox()
         elem.size(bbox.width, bbox.height)
      }

      function connect(start, end) {
         const startPoint = [start.cx(), start.cy()]
         const endPoint = [end.cx(), end.cy()]
         const pl = draw.polyline([startPoint, endPoint]).fill('none').stroke({ color: 'black', width: 4, linecap: 'round', linejoin: 'round' })
         start.before(pl)
      }

      function max(arr) {
         console.log(arr)
         return arr.reduce((a, b) => Math.max(a, b))
      }

      function Node() {
         const content = []
         const directions = ['right', 'left', 'top', 'bottom']
         const opposite = {
            right: 'left',
            left: 'right',
            top: 'bottom',
            bottom: 'top'
         }
         
         const neighbor = {
            right: undefined,
            left: undefined,
            top: undefined,
            bottom: undefined
         }

         function setNeighbor(dir, elem) {
            if(left !== node) {
               left = node
               if(node !== undefined) {
                  node.right(that)
               }
            }
         }
         
         
         const that = {
            add: elem => {
               content.push(elem)
            },

            width: () => {
               return max(content.map(elem => elem.bbox().width))
            },

            height: () => {
               return max(content.map(elem => elem.bbox().height))
            },

            left: node => {
               if(left !== node) {
                  left = node
                  if(node !== undefined) {
                     node.right(that)
                  }
               }
            },
            right: node => {
               right = node
               node.left(that)
            },
            top: node => {
               top = node
               node.bottom(that)
            },
            bottom: node => {
               bottom = node
               node.top(that)
            }
         }

         return that
      }

      const node = Node()
      node.add(draw.rect().size(200, 100))
      node.add(draw.text("Hello World Hello World Hello World Hello World Hello World").move(200, 200))
      console.log(node.width())

      //connect(rect, rect2)
   </script>
</body>
</html>